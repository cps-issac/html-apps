<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- iOS Display Configuration -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- 'default' gives white status bar with black text -->
    <meta name="apple-mobile-web-app-status-bar-style" content="default"> 
    <meta name="theme-color" content="#FFFFFF">
    <!-- Force Light Mode -->
    <meta name="color-scheme" content="light"> 
    
    <title>Daily Fit Plan</title>
    <style>
        :root {
            /* Palette - Strictly Light Mode */
            --bg-body: #F2F2F7; /* Apple System Gray 6 */
            --bg-card: #FFFFFF;
            --text-primary: #000000;
            --text-secondary: #8E8E93;
            --accent: #007AFF; /* System Blue */
            --danger: #FF3B30;
            --separator: #E5E5EA;
            
            --radius-l: 16px;
            --radius-m: 10px;
            --shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* RESET */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif; }
        
        body, html {
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            height: 100%;
            /* Force white background to prevent dark mode bleed */
            background: var(--bg-body) !important; 
        }

        /* UTILS */
        .hidden { display: none !important; }
        .flex-row { display: flex; align-items: center; }
        .flex-col { display: flex; flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .text-sm { font-size: 13px; color: var(--text-secondary); }
        .text-xs { font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .bold { font-weight: 600; }

        /* BUTTONS */
        .btn { border: none; background: none; cursor: pointer; padding: 8px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .btn:active { opacity: 0.6; background: rgba(0,0,0,0.05); }
        .btn-primary { background: var(--text-primary); color: white; padding: 12px 20px; border-radius: 12px; font-weight: 600; width: 100%; font-size: 16px; }
        .btn-icon { font-size: 18px; width: 32px; height: 32px; color: var(--accent); }
        .btn-danger { color: var(--danger); }
        .btn-add { background: var(--bg-card); border: 1px solid var(--accent); color: var(--accent); width: 100%; padding: 10px; font-weight: 600; margin-top: 10px; }

        /* HEADER */
        header {
            background: var(--bg-card);
            padding: calc(env(safe-area-inset-top) + 10px) 20px 15px;
            border-bottom: 1px solid var(--separator);
            position: sticky; top: 0; z-index: 10;
        }

        /* SCROLL AREAS */
        .scroll-view { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }

        /* HOME LIST */
        .card { background: var(--bg-card); border-radius: var(--radius-l); padding: 16px; margin-bottom: 16px; box-shadow: var(--shadow); }
        .section-header { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: baseline; }
        .list-item { display: flex; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--separator); }
        .list-item:last-child { border-bottom: none; }
        .icon-box { width: 36px; height: 36px; background: #F2F2F7; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        
        /* EDITOR STYLES (Compact) */
        .editor-section { background: var(--bg-card); border-radius: var(--radius-l); overflow: hidden; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.05); }
        .editor-header { background: #E5E5EA; padding: 10px 15px; display: flex; gap: 10px; align-items: center; }
        .editor-item-row { padding: 10px 15px; border-bottom: 1px solid var(--separator); background: white; }
        
        .inp { background: transparent; border: 1px solid #ddd; padding: 6px; border-radius: 6px; font-size: 14px; -webkit-appearance: none; }
        .inp-bare { border: none; background: transparent; font-size: 16px; font-weight: 600; width: 100%; padding: 0; }
        .inp-sm { width: 60px; text-align: center; }
        .inp-area { width: 100%; border: 1px solid #eee; padding: 8px; font-size: 12px; border-radius: 6px; resize: none; margin-top: 5px; height: 40px; }

        /* PLAYER OVERLAY */
        #view-player {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFFFFF; z-index: 100;
            display: flex; flex-direction: column;
            padding-top: env(safe-area-inset-top);
        }
        .player-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .timer-display { font-size: 80px; font-weight: 800; font-variant-numeric: tabular-nums; line-height: 1; margin: 20px 0; letter-spacing: -2px; }
        .desc-box { background: #F2F2F7; padding: 15px; border-radius: 12px; text-align: left; width: 100%; font-size: 14px; line-height: 1.4; color: var(--text-secondary); margin-bottom: 20px; }
        
        /* BOTTOM BAR */
        .bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--bg-card); border-top: 1px solid var(--separator);
            padding: 10px 0 25px;
            display: flex; justify-content: space-around;
            z-index: 50;
        }
        .nav-btn { color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; background: none; border: none; }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 22px; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header id="app-header">
        <div class="flex-row justify-between">
            <h1 style="margin:0; font-size: 24px;">Daily Plan</h1>
            <button class="btn btn-primary" style="width:auto; padding: 8px 16px; font-size: 14px;" onclick="startWorkout()">Start ‚ñ∂</button>
        </div>
    </header>

    <!-- HOME VIEW -->
    <div id="view-home" class="scroll-view">
        <div id="plan-container"></div>
    </div>

    <!-- EDITOR VIEW -->
    <div id="view-editor" class="scroll-view hidden" style="background: #F2F2F7;">
        <div class="flex-row justify-between" style="margin-bottom:15px;">
            <h2 style="margin:0">Edit Master Plan</h2>
            <button class="btn" style="color:var(--accent); font-weight:600" onclick="saveEditor()">Done</button>
        </div>
        
        <div id="editor-list"></div>
        
        <button class="btn btn-add" onclick="addNewSection()">+ Add New Section</button>
        <button class="btn" style="width:100%; color: var(--danger); margin-top: 30px;" onclick="resetToDefault()">Reset to Defaults</button>
        <div style="height:50px"></div>
    </div>

    <!-- PLAYER VIEW -->
    <div id="view-player" class="hidden">
        <div style="padding: 15px 20px; display: flex; justify-content: space-between;">
            <span class="text-xs" id="progress-txt">1 / 10</span>
            <button class="btn" onclick="quitWorkout()">‚úï</button>
        </div>
        
        <!-- Progress Bar -->
        <div style="height: 4px; background: #eee; width: 100%;">
            <div id="progress-fill" style="height: 100%; background: var(--accent); width: 0%;"></div>
        </div>

        <div class="player-content">
            <div class="text-xs bold" id="player-type" style="color:var(--accent)">READY</div>
            <h2 id="player-title" style="font-size: 32px; margin: 10px 0;">Get Ready</h2>
            
            <div class="timer-display" id="timer-val">00</div>
            
            <div class="desc-box">
                <strong style="display:block; margin-bottom:4px; color:black;">Instructions:</strong>
                <span id="player-desc">...</span>
            </div>

            <div style="display: flex; gap: 10px; width: 100%;">
                <button class="btn" style="background: #eee; flex: 1; padding: 15px;" onclick="nextStep()">Skip</button>
                <button id="main-btn" class="btn btn-primary" style="flex: 2;" onclick="toggleTimer()">Start</button>
            </div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <div class="bottom-bar">
        <button class="nav-btn active" onclick="switchTab('home')" id="tab-home">
            <span class="nav-icon">üè†</span>Home
        </button>
        <button class="nav-btn" onclick="switchTab('editor')" id="tab-editor">
            <span class="nav-icon">üìù</span>Edit Plan
        </button>
    </div>

    <script>
        // --- DEFAULT DATA ---
        const DEFAULT_DATA = {
            sections: [
                {
                    title: "ÁÜ±Ë∫´ (Warm Up)",
                    repeats: 1,
                    sectionRest: 0,
                    items: [
                        { name: "ÂéüÂú∞Ë∏èÊ≠•/Ë∑≥Áπ©", type: "timer", val: 30, rest: 0, icon: "üî•", desc: "ËºïÈ¨ÜË∏èÊ≠•ÊàñÊ®°Êì¨Ë∑≥Áπ©Ôºå‰øùÊåÅÂëºÂê∏Êö¢È†Ü„ÄÇ" },
                        { name: "ÊâãËáÇÁπûÂúà", type: "reps", val: 10, rest: 0, icon: "üôÜ", desc: "ÂêëÂâç10Ê¨°ÔºåÂêëÂæå10Ê¨°„ÄÇÂπÖÂ∫¶Ë¶ÅÂ§ß„ÄÇ" },
                        { name: "Ë≤ìÁâõÂºè‰º∏Â±ï", type: "reps", val: 10, rest: 0, icon: "üêà", desc: "Âê∏Ê∞£Â°åËÖ∞Êä¨È†≠ÔºåÂëºÊ∞£Êã±ËÉå‰ΩéÈ†≠„ÄÇ" }
                    ]
                },
                {
                    title: "Push Up ÁµÑÂêà",
                    repeats: 2,
                    sectionRest: 60,
                    items: [
                        { name: "Ê®ôÊ∫ñ Push Up", type: "reps", val: 12, rest: 30, icon: "üí™", desc: "ÊâãÊéåËÇ©‰∏ãÔºåË∫´Áõ¥Á∑ö„ÄÇËÇòÂêëÂæå45Â∫¶„ÄÇ" },
                        { name: "Diamond Push Up", type: "reps", val: 8, rest: 30, icon: "üí†", desc: "ÊãáÊåáÈ£üÊåáË≤ºÊàêÈëΩÁü≥ÂΩ¢„ÄÇÈáùÂ∞ç‰∏âÈ†≠ËÇå„ÄÇ" },
                        { name: "Wide Push Up", type: "reps", val: 10, rest: 30, icon: "‚ÜîÔ∏è", desc: "ÊâãÈóäÈÅéËÇ©1.5ÂÄç„ÄÇÈáùÂ∞çËÉ∏Â§ñÂÅ¥„ÄÇ" }
                    ]
                },
                {
                    title: "ËÖπËÇåÂ∞àÈ†Ö",
                    repeats: 2,
                    sectionRest: 60,
                    items: [
                        { name: "Plank Ê£íÂºè", type: "timer", val: 45, rest: 0, icon: "üß±", desc: "ËÇòËÇ©‰∏ãÔºåÂâçËáÇË≤ºÂú∞„ÄÇÊî∂ËÇöÂ§æËáÄ„ÄÇ" },
                        { name: "Dead Bug", type: "reps", val: 20, rest: 0, icon: "üêû", desc: "Âπ≥Ë∫∫ÊâãÂêëÂ§©ÔºåËÜù90Â∫¶„ÄÇÂ∞çÂÅ¥ÊâãËÖ≥‰º∏Áõ¥„ÄÇ" },
                        { name: "Bicycle Crunch", type: "reps", val: 20, rest: 0, icon: "üö≤", desc: "ÊâãËºïÊéÇËÄ≥„ÄÇÂè≥ËÇòÊéÇÂ∑¶ËÜùÔºåÂ∑¶Âè≥‰∫§Êõø„ÄÇ" },
                        { name: "Mountain Climber", type: "reps", val: 20, rest: 30, icon: "üßó", desc: "È´òÊùøÂºèÔºåËÜùÊãâÂêëËÉ∏„ÄÇÂ±ÅËÇ°ÂãøÂçáÂ§™È´ò„ÄÇ" }
                    ]
                },
                {
                    title: "Êî∂Êìç (Cool Down)",
                    repeats: 1,
                    sectionRest: 0,
                    items: [
                        { name: "ÁúºÈè°ËõáÂºè", type: "timer", val: 40, rest: 0, icon: "üêç", desc: "‰øØËá•ÔºåÊâãÊé®Âú∞Êä¨Ëµ∑‰∏äË∫´Ôºå‰º∏Â±ïËÖπÈÉ®„ÄÇ" },
                        { name: "Â¨∞ÂÖíÂºè", type: "timer", val: 40, rest: 0, icon: "üë∂", desc: "Ë∑™ÂßøÔºåËáÄÂùêËÖ≥Ë∏≠ÔºåË∫´Ë∂¥Ââç„ÄÇ" },
                        { name: "ÂùêÂßøÂâçÂΩé", type: "timer", val: 40, rest: 0, icon: "üßò", desc: "ÂùêÁõ¥ËÖ≥‰º∏Áõ¥ÔºåË∫´È´îÂêëÂâçÊë∫Ôºå‰º∏Â±ïËÖøÂæå„ÄÇ" }
                    ]
                }
            ]
        };

        let plan = JSON.parse(localStorage.getItem('myFitPlan_v2')) || DEFAULT_DATA;

        // --- APP LOGIC ---

        function init() {
            renderHome();
        }

        function switchTab(tab) {
            document.querySelectorAll('.scroll-view').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            if(tab === 'home') {
                document.getElementById('view-home').classList.remove('hidden');
                document.getElementById('tab-home').classList.add('active');
                renderHome();
            } else {
                document.getElementById('view-editor').classList.remove('hidden');
                document.getElementById('tab-editor').classList.add('active');
                renderEditor();
            }
        }

        // --- RENDER HOME ---
        function renderHome() {
            const c = document.getElementById('plan-container');
            c.innerHTML = "";
            
            plan.sections.forEach(sec => {
                const card = document.createElement('div');
                card.className = "card";
                
                let listHtml = "";
                sec.items.forEach(item => {
                    const badge = item.type === 'timer' ? `${item.val}s` : `x${item.val}`;
                    listHtml += `
                    <div class="list-item">
                        <div class="icon-box">${item.icon}</div>
                        <div style="flex:1">
                            <div class="flex-row justify-between">
                                <span class="bold">${item.name}</span>
                                <span style="background:#eee; padding:2px 8px; border-radius:4px; font-size:12px;">${badge}</span>
                            </div>
                            <div class="text-sm" style="margin-top:2px;">${item.desc.substring(0, 30)}...</div>
                        </div>
                    </div>`;
                });

                card.innerHTML = `
                    <div class="section-header">
                        <span class="bold" style="font-size:18px">${sec.title}</span>
                        <span class="text-xs">${sec.repeats} Set(s)</span>
                    </div>
                    ${listHtml}
                `;
                c.appendChild(card);
            });
        }

        // --- RENDER EDITOR (COMPACT & FUNCTIONAL) ---
        function renderEditor() {
            const list = document.getElementById('editor-list');
            list.innerHTML = "";

            plan.sections.forEach((sec, sIdx) => {
                const secEl = document.createElement('div');
                secEl.className = "editor-section";

                // Section Header
                secEl.innerHTML = `
                    <div class="editor-header">
                        <div class="flex-col" style="flex:1">
                            <input class="inp-bare" value="${sec.title}" onchange="updateData('sec-title', ${sIdx}, null, this.value)" placeholder="Section Title">
                            <div class="flex-row gap-2" style="margin-top:5px;">
                                <span class="text-xs">Sets:</span>
                                <input type="number" class="inp inp-sm" value="${sec.repeats}" onchange="updateData('sec-rep', ${sIdx}, null, this.value)">
                                <span class="text-xs">Set Rest(s):</span>
                                <input type="number" class="inp inp-sm" value="${sec.sectionRest}" onchange="updateData('sec-rest', ${sIdx}, null, this.value)">
                            </div>
                        </div>
                        <div class="flex-row">
                            <button class="btn btn-icon" onclick="moveSection(${sIdx}, -1)">‚ñ≤</button>
                            <button class="btn btn-icon" onclick="moveSection(${sIdx}, 1)">‚ñº</button>
                            <button class="btn btn-icon btn-danger" onclick="delSection(${sIdx})">üóë</button>
                        </div>
                    </div>
                `;

                // Items
                sec.items.forEach((item, iIdx) => {
                    const row = document.createElement('div');
                    row.className = "editor-item-row";
                    row.innerHTML = `
                        <div class="flex-row gap-2" style="margin-bottom:8px;">
                            <input class="inp" style="width:40px; text-align:center" value="${item.icon}" onchange="updateData('item-icon', ${sIdx}, ${iIdx}, this.value)">
                            <input class="inp" style="flex:1; font-weight:600" value="${item.name}" onchange="updateData('item-name', ${sIdx}, ${iIdx}, this.value)">
                            <button class="btn btn-icon" style="font-size:14px" onclick="delItem(${sIdx}, ${iIdx})">‚úï</button>
                        </div>
                        <div class="flex-row gap-2 justify-between">
                            <div class="flex-row gap-2">
                                <select class="inp" onchange="updateData('item-type', ${sIdx}, ${iIdx}, this.value)">
                                    <option value="reps" ${item.type==='reps'?'selected':''}>Reps</option>
                                    <option value="timer" ${item.type==='timer'?'selected':''}>Timer</option>
                                </select>
                                <input type="number" class="inp inp-sm" value="${item.val}" onchange="updateData('item-val', ${sIdx}, ${iIdx}, this.value)">
                                <span class="text-xs">Rest:</span>
                                <input type="number" class="inp inp-sm" value="${item.rest}" onchange="updateData('item-rest', ${sIdx}, ${iIdx}, this.value)">
                            </div>
                            <div class="flex-row">
                                <button class="btn" style="color:var(--accent)" onclick="moveItem(${sIdx}, ${iIdx}, -1)">‚ñ≤</button>
                                <button class="btn" style="color:var(--accent)" onclick="moveItem(${sIdx}, ${iIdx}, 1)">‚ñº</button>
                            </div>
                        </div>
                        <textarea class="inp-area" placeholder="How to do..." onchange="updateData('item-desc', ${sIdx}, ${iIdx}, this.value)">${item.desc}</textarea>
                    `;
                    secEl.appendChild(row);
                });

                // Add Item Button
                const addBtn = document.createElement('div');
                addBtn.style.padding = "10px";
                addBtn.innerHTML = `<button class="btn" style="width:100%; color:var(--accent); background:#F9F9F9; border:1px dashed #ccc" onclick="addItem(${sIdx})">+ Add Item</button>`;
                secEl.appendChild(addBtn);

                list.appendChild(secEl);
            });
        }

        // --- DATA MANIPULATION HELPERS ---

        function updateData(key, sIdx, iIdx, val) {
            if(key === 'sec-title') plan.sections[sIdx].title = val;
            if(key === 'sec-rep') plan.sections[sIdx].repeats = parseInt(val);
            if(key === 'sec-rest') plan.sections[sIdx].sectionRest = parseInt(val);
            
            if(iIdx !== null) {
                if(key === 'item-name') plan.sections[sIdx].items[iIdx].name = val;
                if(key === 'item-icon') plan.sections[sIdx].items[iIdx].icon = val;
                if(key === 'item-type') plan.sections[sIdx].items[iIdx].type = val;
                if(key === 'item-val') plan.sections[sIdx].items[iIdx].val = parseInt(val);
                if(key === 'item-rest') plan.sections[sIdx].items[iIdx].rest = parseInt(val);
                if(key === 'item-desc') plan.sections[sIdx].items[iIdx].desc = val;
            }
        }

        function addNewSection() {
            plan.sections.push({ title: "New Section", repeats: 1, sectionRest: 0, items: [] });
            renderEditor();
        }

        function addItem(sIdx) {
            plan.sections[sIdx].items.push({ name: "Exercise", type: "reps", val: 10, rest: 0, icon: "‚ö°", desc: "" });
            renderEditor();
        }

        function delSection(sIdx) {
            if(confirm('Delete section?')) {
                plan.sections.splice(sIdx, 1);
                renderEditor();
            }
        }

        function delItem(sIdx, iIdx) {
            plan.sections[sIdx].items.splice(iIdx, 1);
            renderEditor();
        }

        function moveSection(sIdx, dir) {
            if (sIdx + dir < 0 || sIdx + dir >= plan.sections.length) return;
            [plan.sections[sIdx], plan.sections[sIdx + dir]] = [plan.sections[sIdx + dir], plan.sections[sIdx]];
            renderEditor();
        }

        function moveItem(sIdx, iIdx, dir) {
            const items = plan.sections[sIdx].items;
            if (iIdx + dir < 0 || iIdx + dir >= items.length) return;
            [items[iIdx], items[iIdx + dir]] = [items[iIdx + dir], items[iIdx]];
            renderEditor();
        }

        function saveEditor() {
            localStorage.setItem('myFitPlan_v2', JSON.stringify(plan));
            switchTab('home');
        }

        function resetToDefault() {
            if(confirm("Reset everything to default plan?")) {
                plan = JSON.parse(JSON.stringify(DEFAULT_DATA));
                saveEditor();
            }
        }

        // --- PLAYER LOGIC ---
        let queue = [];
        let qIdx = 0;
        let timer = null;
        let timeLeft = 0;
        let isPaused = true;

        function startWorkout() {
            // Build Queue
            queue = [];
            queue.push({ type:'msg', title:'Get Ready', desc:'Prepare your space.', val:5, isRest:true });
            
            plan.sections.forEach(sec => {
                for(let i=0; i<sec.repeats; i++) {
                    sec.items.forEach(item => {
                        queue.push({ ...item, isRest: false });
                        if(item.rest > 0) queue.push({ type:'timer', title:'Rest', desc:'Catch your breath.', val:item.rest, isRest:true });
                    });
                    if(sec.sectionRest > 0 && i < sec.repeats - 1) {
                        queue.push({ type:'timer', title:'Set Break', desc:'Big rest between sets.', val:sec.sectionRest, isRest:true });
                    }
                }
            });
            queue.push({ type:'finish', title:'Workout Complete', desc:'Great job!', val:0 });
            
            document.getElementById('view-player').classList.remove('hidden');
            document.getElementById('app-header').classList.add('hidden');
            document.querySelector('.bottom-bar').classList.add('hidden');
            
            qIdx = 0;
            loadStep(0);
        }

        function loadStep(idx) {
            clearInterval(timer);
            const step = queue[idx];
            
            document.getElementById('progress-txt').innerText = `${idx+1} / ${queue.length}`;
            document.getElementById('progress-fill').style.width = `${((idx)/queue.length)*100}%`;
            
            const title = document.getElementById('player-title');
            const desc = document.getElementById('player-desc');
            const type = document.getElementById('player-type');
            const val = document.getElementById('timer-val');
            const btn = document.getElementById('main-btn');
            
            if(step.type === 'finish') {
                title.innerText = step.title;
                val.innerText = "üéâ";
                desc.innerText = step.desc;
                btn.innerText = "Finish";
                btn.onclick = quitWorkout;
                return;
            }

            title.innerText = step.title || step.name;
            desc.innerText = step.desc || "";
            
            if(step.isRest) {
                type.innerText = "REST";
                type.style.color = "#999";
            } else {
                type.innerText = "WORKOUT";
                type.style.color = "var(--accent)";
            }

            if(step.type === 'reps') {
                val.innerText = `x${step.val}`;
                btn.innerText = "DONE";
                btn.onclick = nextStep;
                isPaused = true;
            } else {
                // Timer
                timeLeft = step.val;
                val.innerText = formatTime(timeLeft);
                btn.innerText = "START";
                btn.onclick = toggleTimer;
                isPaused = true;
                // Auto start for rest? optional. Let's manual start for control
                toggleTimer(); 
            }
        }

        function toggleTimer() {
            if(!isPaused) {
                // Pause
                isPaused = true;
                clearInterval(timer);
                document.getElementById('main-btn').innerText = "RESUME";
            } else {
                // Start
                isPaused = false;
                document.getElementById('main-btn').innerText = "PAUSE";
                timer = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer-val').innerText = formatTime(timeLeft);
                    if(timeLeft <= 0) {
                        clearInterval(timer);
                        nextStep();
                    }
                }, 1000);
            }
        }

        function nextStep() {
            qIdx++;
            if(qIdx < queue.length) loadStep(qIdx);
            else quitWorkout();
        }

        function quitWorkout() {
            clearInterval(timer);
            document.getElementById('view-player').classList.add('hidden');
            document.getElementById('app-header').classList.remove('hidden');
            document.querySelector('.bottom-bar').classList.remove('hidden');
        }

        function formatTime(s) {
            const m = Math.floor(s/60);
            const sec = s%60;
            return `${m}:${sec<10?'0'+sec:sec}`;
        }

        init();
    </script>
</body>
</html>
